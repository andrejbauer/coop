operation get : unit -> int
operation put : int -> unit

operation get' : unit -> int
operation put' : int -> unit

operation tick : unit -> int

let state (w0 : int) =
  comodel w0 with
  | get t @ w -> (w, w)
  | put x @ w -> ((), x)
  end

let ticker =
  comodel 0 with
  | tick () @ w -> (w, w+1)
  end

let c (n : int) = state n âŠ— ticker

let demo1 =
  using c 10 in
    let a = get () in
    put 2 ;
    let b = tick () in
    let c = tick () in
    put 3 ;
    (a, b, c)
  finally
    val x @ w -> (x, w)
  end

let demo2 =
  using state 2 :*: (state 3 with {get as get', put as put'}) in
    let a = get () in
    put' (a + 3) ;
    put 7 ;
    let b = get' () in
    put' (b + 10) ;
    (a, b)
  finally
    val x @ w -> (x, w)
  end