signal boom of unit

let rec f (x : int) : empty ! {boom} = boom ()

let g (x : int) =
  use (cohandler () with end) in
    (match f x with end) : int ! {boom}
  finally
  | val x @ _ -> x
  | boom _ @ _ -> boom ()
  end
;;

use stdio ;;

use (cohandler () with end) in
  g 43
finally
 | val x @ _ -> print_int x
 | boom _ @ _ -> print_string "Boom!\n"
end